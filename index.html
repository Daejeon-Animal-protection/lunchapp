<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Lunch Check</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
     body { font-family: sans-serif; background: #f4f4f4; padding: 20px; text-align: center; }
    button { margin: 4px; padding: 8px 12px; }
    .section { display: none; margin-top: 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; font-size: 12px; }
    th { background-color: #eee; }
    .highlight { font-weight: bold; }
    .small-btn { font-size: 10px; margin-left: 4px;text-align: center; }
    .expense-input { width: 80px; }
    #estimateDetails { display: none; text-align: left; max-width: 600px; margin: 10px auto; font-size: 12px; }
    .group-header { background-color: #ccc;font-weight: bold; font-size: 14px; text-align: center; }
    #employeeList {  display: flex;  flex-direction: column;   align-items: center;   list-style: none;  padding: 0;  margin: 0 auto;} 
    #nightShiftSettings {  display: none;  margin-top: 16px;  border: 1px solid #ccc;  padding: 12px;  background: #fafafa;  }
  #nightShiftSettings .header {    display: flex;    justify-content: space-between;    align-items: center;    margin-bottom: 8px;  }
  #nightShiftSettings .header h2 {    margin: 0;    font-size: 18px;  }
   #nightShiftSettings .inner {    display: flex;    align-items: center;    gap: 12px;  }
  #nightShiftSettings .list-box {    flex: 1;    border: 1px solid #bbb;    padding: 8px;    min-height: 200px;  }
  #nightShiftSettings .list-box h3 {    margin-top: 0;    font-size: 16px;    text-align: center;  }
    #nightShiftSettings ul {    list-style: none;    padding: 0;    margin: 0;    max-height: 200px;    overflow: auto;  }
  #nightShiftSettings ul li {    padding: 4px 8px;    cursor: pointer;  }
    #nightShiftSettings ul li.selected {    background-color: #d1eaff;  }
  #nightShiftSettings .move-buttons {    display: flex;    flex-direction: column;    gap: 8px;  }
  .upload-box {  margin-top: 20px;  padding: 12px;  border: 1px solid #ccc;  background: #fafafa;  display: inline-block;  text-align: left;  font-size: 14px;}
.upload-box input[type="file"] {  margin-bottom: 10px;}.upload-box button {  margin-left: 8px;  padding: 6px 12px;}
.upload-log {  margin-top: 10px;  background: #f0f0f0;  padding: 10px;  white-space: pre-wrap;  min-height: 40px;}
.toggle-buttons {  display: flex;  gap: 8px;  justify-content: center;  margin-bottom: 12px;}
#employeeSettings,#nightShiftSettings,#excelUploadSection {  display: none;}
 </style>
</head>
<body>
  <div>
      <button id="btnStats">ğŸ“Š ê°œì¸ë³„ ì‹ì‚¬ í†µê³„</button>
    <button id="btnExpenses">ğŸ“‹ ì‹ë‹¹ìš´ì˜ë¹„ê´€ë¦¬</button>
    <button id="btnCharges">ğŸ’° ì‹ëŒ€ ì§•ìˆ˜</button>
    <button id="btnSettings">âš™ï¸ ì„¤ì •</button>
  </div>

    <!-- ê°œì¸ë³„ ì‹ì‚¬ í†µê³„ ì„¹ì…˜ -->
  <div id="stats" class="section">
    <label>ğŸ“… ì›” ì„ íƒ: </label>
    <select id="monthSelectStats"></select>
    <h1>ğŸ“Š ê°œì¸ë³„ ì‹ì‚¬ í†µê³„</h1>
    <table>
      <thead id="statsHead"></thead>
      <tbody id="statsBody"></tbody>
    </table>
  </div>


   <!-- ì‹ë‹¹ìš´ì˜ë¹„ê´€ë¦¬ ì„¹ì…˜ -->
 <div id="expenses" class="section">
    <label>ğŸ“… ì›” ì„ íƒ: <select id="monthSelectExpenses"></select></label>
    <h1>ğŸ“‹ ì‹ë‹¹ìš´ì˜ë¹„ê´€ë¦¬</h1>
    <button id="addExpenseRow">â• í–‰ ì¶”ê°€</button>
    <table>
      <thead><tr><th>ì›”</th><th>ìˆ˜ì…ì•¡</th><th>ì§€ì¶œì•¡</th><th>ì°¨ì•¡</th><th>ì‚­ì œ</th></tr></thead>
      <tbody id="expenseTableBody"></tbody>
    </table>
    <h2 id="nextMonthEstimate"></h2>
    <button id="toggleEstimate">ìì„¸íˆ ë³´ê¸°</button>
    <div id="estimateDetails"></div>
  </div>

  <!-- ì‹ëŒ€ ì§•ìˆ˜ ì„¹ì…˜ -->
  <div id="charges" class="section">
    <label>ğŸ“… ì›” ì„ íƒ:<select id="monthSelectCharges"></select></label>
    <h1>ğŸ’° ì‹ëŒ€ ì§•ìˆ˜</h1>
    <table>
      <thead><tr><th>ì´ë¦„</th><th>ì‹ì‚¬íšŸìˆ˜</th><th>ê¸°ë³¸ ì‹ë¹„</th><th>ì¶”ê°€ ì‹ë¹„</th><th>ì´ì•¡</th></tr></thead>
      <tbody id="chargeTableBody"></tbody>
    </table>
  </div>

  <!-- ì„¤ì • ì„¹ì…˜ -->
  <div id="settings" class="section">
    <h1>âš™ï¸ ì„¤ì •</h1>
    <div class="toggle-buttons">
      <button id="btnEmployees">ğŸ‘¥ ì§ì›ëª©ë¡</button>
      <button id="btnNightShift">ğŸŒ™ ì•¼ê°„ì¡°ê´€ë¦¬</button>
      <button id="btnExcelUpload">ğŸ“‚ ì—‘ì…€ ì—…ë¡œë“œ</button>
      </div>
     <div id="employeeSettings" style="display:none;">
      <input id="newEmployee" placeholder="ì§ì›ì´ë¦„ ì…ë ¥"/>
      <button id="addEmployeeBtn">â• ì¶”ê°€</button>
      <button id="saveAllBtn">ğŸ’¾ ì €ì¥</button>
      <ul id="employeeList"></ul>
    </div> 
    <div id="nightShiftSettings">
        <div class="header">
        <h2>ì•¼ê°„ì¡° ì‹ì‚¬ì—¬ë¶€ ê´€ë¦¬</h2>
        <button id="saveNightShiftBtn">ğŸ’¾ ì €ì¥</button>
        </div>
      <div class="inner">
        <div class="list-box">
        <h3>ì•¼ê°„ì¡° ì¤‘ ì‹ì‚¬í•˜ëŠ” ì‚¬ëŒ</h3>
        <ul id="leftNightList"></ul>
      </div>
    <div class="move-buttons">
        <button id="moveToRightBtn">â¡ï¸</button>
        <button id="moveToLeftBtn">â¬…ï¸</button>
    </div>
    <div class="list-box">
        <h3>ì•¼ê°„ì¡° ì¤‘ ì‹ì‚¬ ì•ˆí•˜ëŠ” ì‚¬ëŒ</h3>
        <ul id="rightNightList"></ul>
    </div>
    </div>
     </div>
     <div id="excelUploadSection" style="display:none;">
  <h2>ğŸ“‚ ì—‘ì…€ ì—…ë¡œë“œ (íœ´ë¬´ì/ì•¼ê°„ì¡°)</h2>
  <div class="upload-box">
    <input type="file" id="fileInput" accept=".csv" />
    <button id="uploadBtn">ğŸš€ ì—…ë¡œë“œ</button>
    <div id="uploadLog" class="upload-log"></div>
  </div>
</div>
  </div>


  <script>
// Firebase ì´ˆê¸°í™”
    firebase.initializeApp({
      apiKey: "AIzaSyD5TK7QNHXvQsjKNQ7136SxhP_lJ9PdbsM",
      authDomain: "lunch-20bb8.firebaseapp.com",
      databaseURL: "https://lunch-20bb8-default-rtdb.firebaseio.com",
      projectId: "lunch-20bb8"
    });
    const db = firebase.database();
    const expenseRef = db.ref('expenseData'); 

    let employees = [];
    let regularList = ["ì´ì˜ì¼","ì´í˜„ìŠ¹","ê¹€ì„±ë™","ë°•ë³‘ì‚¼","ê¹€í•˜ì€","ê¹€ë¯¸ì§€","í•œìˆ˜ì§„","ê¹€í˜œê²½","ì„ì •ì•„"];
    let expenseData = [
    { month:'2025-01', income:265000, expense:404650 },
    { month:'2025-02', income:1170000, expense:1212510 },
    { month:'2025-03', income:1170000, expense:1171310 },
    { month:'2025-04', income:1905000, expense:1656100 }
  ];

     const historicalMonthlyAverages = {
  '2024-04': { ì›”:14.8,   í™”:17.75,  ìˆ˜:19.25,  ëª©:19.75,  ê¸ˆ:10.5   },
  '2024-05': { ì›”:6.6667, í™”:14.25,  ìˆ˜:17.25,  ëª©:19.75,  ê¸ˆ:17     },
  '2024-06': { ì›”:6.75,   í™”:18.5,   ìˆ˜:18.75,  ëª©:19.3333,ê¸ˆ:14.3333},
  '2024-07': { ì›”:6,      í™”:19.5,   ìˆ˜:18.75,  ëª©:19.5,   ê¸ˆ:15.3333},
  '2024-08': { ì›”:7,      í™”:19.75,  ìˆ˜:17.6667,ëª©:19,     ê¸ˆ:17.25  },
  '2024-09': { ì›”:10.6667,í™”:19,     ìˆ˜:19.6667,ëª©:20,     ê¸ˆ:20.3333},
  '2024-10': { ì›”:7,      í™”:13.3333,ìˆ˜:16,     ëª©:14.3333,ê¸ˆ:12.5   },
  '2024-11': { ì›”:10.75,  í™”:18.25,  ìˆ˜:16,     ëª©:18.3333,ê¸ˆ:14.25  },
  '2024-12': { ì›”:9.2,    í™”:17,     ìˆ˜:14.3333,ëª©:17.75,  ê¸ˆ:16     },
  '2025-01': { ì›”:7,      í™”:15,     ìˆ˜:14,     ëª©:12,     ê¸ˆ:10     },
  '2025-02': { ì›”:5.75,   í™”:11,     ìˆ˜:13,     ëª©:13.75,  ê¸ˆ:14     },
  '2025-03': { ì›”:10.25,  í™”:13,     ìˆ˜:13.25,  ëª©:14,     ê¸ˆ:8.25   },
  '2025-04': { ì›”:7.25,   í™”:20.5,   ìˆ˜:20.25,  ëª©:19.75,  ê¸ˆ:19.25  }
};
    
//ì›”ì„ íƒ
   function initMonthOptions(id) {
        const sel = document.getElementById(id);
        if (!sel) return;
        sel.innerHTML = '';
        const now = new Date(), year = now.getFullYear();
        for (let m = 1; m <= 12; m++) {
          const mm = String(m).padStart(2,'0');
          sel.append(new Option(`${year}-${mm}`, `${year}-${mm}`));
        }
        const defaultVal = `${year}-${String(now.getMonth()+1).padStart(2,'0')}`;
        sel.value = defaultVal;
      }

  function showSection(id) {
    document.querySelectorAll('.section').forEach(s => s.style.display='none');
    const sec = document.getElementById(id);
    if (sec) sec.style.display='block';
  }

async function getKoreanHolidays(y, m) {
      const rawKey = 'dtZOAdfRz5FEy2NGFBIEaHoQhfimWGWodsA2Wzcr+eSSdv1nDcyXk9REdGCzZuZPp32hkYvNFgHJJBeOhQ6H0g==';
      const serviceKey = encodeURIComponent(rawKey);
      const mm = String(m).padStart(2, '0');
      const url = `https://apis.data.go.kr/B090041/openapi/service/SpcdeInfoService/getRestDeInfo`
        + `?ServiceKey=${serviceKey}`
        + `&solYear=${y}`
        + `&solMonth=${mm}`
        + `&numOfRows=31&pageNo=1&_type=json`;
      console.log('ğŸŒ Fetching holiday URL:', url);
      const res = await fetch(url);
      const text = await res.text();
      console.log('ğŸ“„ Raw holiday response:', text);
      try {
        const json = JSON.parse(text);
        const items = json.response.body.items?.item || [];
        return items.map(i => {
          const s = i.locdate.toString();
          return `${s.slice(0,4)}-${s.slice(4,6)}-${s.slice(6,8)}`;
        });
      } catch (error) {
        const parser = new DOMParser();
        const xmlDoc = parser.parseFromString(text, 'application/xml');
        const xmlItems = xmlDoc.getElementsByTagName('item');
        return Array.from(xmlItems).map(item => {
          const s = item.getElementsByTagName('locdate')[0].textContent;
          return `${s.slice(0,4)}-${s.slice(4,6)}-${s.slice(6,8)}`;
        });
      }
    }
async function generateWorkdaysForMonth(y,m) {
 const holidays = await getKoreanHolidays(y, m);
    const days=[];
    const total=new Date(y,m,0).getDate();
    const mm=String(m).padStart(2,'0');
   for (let d = 1; d <= total; d++){
    const iso = `${y}-${mm}-${String(d).padStart(2,'0')}`;
    const dow = new Date(iso).getDay();
    if (dow === 0 || dow === 6) continue;   
    if (holidays.includes(iso)) continue;      days.push(iso);
    }
    return days;
  }

async function renderStatsTable() {
 if (document.getElementById('stats').style.display === 'none') {
    return;
  }
   if (!employees.length) {
    const snapEmp = await db.ref('employees').once('value');
    employees = Object.keys(snapEmp.val() || {});
  }
   const sel = document.getElementById('monthSelectStats').value;
  const [y, m] = sel.split('-').map(Number);

  // ê³µíœ´ì¼Â·ì£¼ë§ ì œì™¸ í‰ì¼ ë°°ì—´ ê°€ì ¸ì˜¤ê¸°
  const sd = await generateWorkdaysForMonth(y, m);
 if (document.getElementById('stats').style.display === 'none') return;
  // í…Œì´ë¸” í—¤ë” ë Œë”ë§í…Œ
  const thead = document.getElementById('statsHead');
  thead.innerHTML = '';
  const headRow = document.createElement('tr');
  headRow.innerHTML = `<th>ì´ë¦„</th>`
    + sd.map(d => `<th>${d.slice(5)}</th>`).join('')
    + `<th>ì´í•©</th>`;
  thead.appendChild(headRow);

  // ë°ì´í„° ê°€ì ¸ì™€ì„œ ê·¸ë£¹ë³„ ë Œë”ë§
  const snapshot = await db.ref('mealLogs').once('value');
  const data = snapshot.val() || {};
  const tbody = document.getElementById('statsBody');
  tbody.innerHTML = '';

  ['ì¼ë°˜ì§','ê¸°ê°„ì œ'].forEach(group => {
    // ê·¸ë£¹ í—¤ë”
    const headerRow = document.createElement('tr');
    headerRow.className = 'group-header';
    headerRow.innerHTML = `<td colspan="${2 + sd.length + 1}">${group}</td>`;
    tbody.appendChild(headerRow);

    const list = group === 'ì¼ë°˜ì§'
      ? employees.filter(n => regularList.includes(n))
      : employees.filter(n => !regularList.includes(n));

    // ì§ì›ë³„ í–‰
    list.forEach(name => {
      let cnt = 0;
      const row = document.createElement('tr');
      row.innerHTML = `<td>${name}</td>`
        + sd.map(d => {
            const v = data[name]?.[d] || '';
            if (v === 'O') cnt++;
            return `<td>${v}</td>`;
          }).join('')
        + `<td class="highlight">${cnt}</td>`;
      tbody.appendChild(row);
    });
  });
}

//ì‹ëŒ€ì§•ìˆ˜ ê¸°ëŠ¥
function renderChargeTable() {
 
  const sel   = document.getElementById('monthSelectCharges').value;
  const tbody = document.getElementById('chargeTableBody');
  tbody.innerHTML = '';
  // â† Promiseë¥¼ ë°˜í™˜í•˜ë„ë¡ return ì¶”ê°€!
  return db.ref('mealLogs').once('value').then(snapshot => {
    const data = snapshot.val() || {};
    let sumTotal = 0;

    ['ì¼ë°˜ì§','ê¸°ê°„ì œ'].forEach(group => {
      // ê·¸ë£¹ í—¤ë”
      const headerRow = document.createElement('tr');
      headerRow.className = 'group-header';
      headerRow.innerHTML = `<td colspan="5">${group}</td>`;
      tbody.appendChild(headerRow);

      let groupSum = 0;
      const list = group === 'ì¼ë°˜ì§'
        ? employees.filter(n => regularList.includes(n))
        : employees.filter(n => !regularList.includes(n));

      list.forEach(name => {
        const cnt   = Object.entries(data[name] || {})
                          .filter(([d,v]) => d.startsWith(sel) && v === 'O')
                          .length;
        const basic = 50000;
        const extra = Math.max(0, cnt - 10) * 5000;
        const total = basic + extra;

        groupSum += total;
        sumTotal  += total;

        const row = document.createElement('tr');
        row.innerHTML =
          `<td>${name}</td>` +
          `<td>${cnt}</td>` +
          `<td>${basic.toLocaleString()}</td>` +
          `<td>${extra.toLocaleString()}</td>` +
          `<td>${total.toLocaleString()}</td>`;
        tbody.appendChild(row);
      });

      // ì†Œê³„ í–‰
      const subtotalRow = document.createElement('tr');
      subtotalRow.className = 'subtotal-row';
      subtotalRow.innerHTML =
        `<td colspan="4" style="text-align:right;"><strong>${group} ì†Œê³„</strong></td>` +
        `<td><strong>${groupSum.toLocaleString()}</strong></td>`;
      tbody.appendChild(subtotalRow);
    });

    // ì „ì²´ í•©ê³„ í–‰
    const totalRow = document.createElement('tr');
    totalRow.className = 'total-row';
    totalRow.innerHTML =
      `<td colspan="4" style="text-align:right;"><strong>ì´í•©ê³„</strong></td>` +
      `<td><strong>${sumTotal.toLocaleString()}</strong></td>`;
    tbody.appendChild(totalRow);

    return sumTotal;  // â† ì—¬ê¸°ì„œ Promiseê°€ resolveí•  ê°’
  });
}

//ì§ì›ëª©ë¡
function renderEmployeeList() {
  const ul = document.getElementById("employeeList");
  ul.innerHTML = '';

  if (employees.length === 0) {
    ul.innerHTML = '<li style="color:gray">ë“±ë¡ëœ ì§ì›ì´ ì—†ìŠµë‹ˆë‹¤.</li>';
    return;
  }

  // --- ì¼ë°˜ì§ ê·¸ë£¹ ì •ì˜ ---
  const regGroupLi = document.createElement('li');
  regGroupLi.innerHTML = '<strong>ì¼ë°˜ì§</strong>';
  const regSubUl = document.createElement('ul');
  regGroupLi.appendChild(regSubUl);
  ul.appendChild(regGroupLi);

  // --- ê¸°ê°„ì œ ê·¸ë£¹ ì •ì˜ ---
  const conGroupLi = document.createElement('li');
  conGroupLi.innerHTML = '<strong>ê¸°ê°„ì œ</strong>';
  const conSubUl = document.createElement('ul');
  conGroupLi.appendChild(conSubUl);
  ul.appendChild(conGroupLi);

  // --- ì§ì›ë³„ í–‰ ì¶”ê°€ ---
  employees.forEach(name => {
    const isRegular = regularList.includes(name);
    addRow(name, isRegular ? regSubUl : conSubUl);
  });
}

function addRow(name, parentUl) {
  const li = document.createElement('li');
  li.style.display = 'flex';
  li.style.alignItems = 'center';
  li.style.columnGap = '4px';

  // ì´ë¦„ input
  const input = document.createElement('input');
  input.type = 'text';
  input.value = name;
  input.disabled = false;
  input.style.flex = '0 0 120px';
  li.appendChild(input);

  // ë²„íŠ¼ ìƒì„± í—¬í¼
  function makeBtn(label, onClick) {
    const btn = document.createElement('button');
    btn.type = 'button';
    btn.textContent = label;
    btn.addEventListener('click', e => {
      e.preventDefault();
      onClick();
    });
    li.appendChild(btn);
  }

  // âœï¸ ìˆ˜ì •
  makeBtn('âœï¸', () => {
    input.disabled = false;
    input.focus();
  });

  // ğŸ”¼ ìœ„ë¡œ
  makeBtn('ğŸ”¼', () => {
    const i = employees.indexOf(name);
    if (i > 0) {
      [employees[i-1], employees[i]] = [employees[i], employees[i-1]];
      db.ref('employees').set(employees);
      renderEmployeeList();
    }
  });

  // ğŸ”½ ì•„ë˜ë¡œ
  makeBtn('ğŸ”½', () => {
    const i = employees.indexOf(name);
    if (i < employees.length - 1) {
      [employees[i], employees[i+1]] = [employees[i+1], employees[i]];
      db.ref('employees').set(employees);
      renderEmployeeList();
    }
  });

  // â†”ï¸ ì§êµ° ì´ë™
  makeBtn(
  regularList.includes(name) ? 'â¡ï¸ ê¸°ê°„ì œ' : 'â¬…ï¸ ì¼ë°˜ì§',
  () => {
    if (regularList.includes(name)) {
      regularList = regularList.filter(n => n !== name);
      db.ref('employeeRoles/' + name).set('contract');
    } else {
      regularList.push(name);
      db.ref('employeeRoles/' + name).set('regular');
    }
    renderEmployeeList();
  }
);

  // âŒ ì‚­ì œ
  makeBtn('âŒ', () => {
    const i = employees.indexOf(name);
    employees.splice(i, 1);
    db.ref('employees').set(employees);
    renderEmployeeList();
  });

  // ê·¸ë£¹ ULì— ë¶™ì´ê¸°
  parentUl.appendChild(li);
}

function addEmployee() {
    const input = document.getElementById('newEmployee');
    const name = input.value.trim();
    if (name && !employees.includes(name)) {
      employees.push(name);
      regularList.push(name);
      db.ref('employees').set(employees);
      input.value = '';
      renderEmployeeList();
    }
  }

//ì‹ë‹¹ìš´ì˜ë¹„ê´€ë¦¬
async function renderExpenseTable() {
    const tbody = document.getElementById('expenseTableBody');
    tbody.innerHTML = '';
       expenseData.forEach((it, i) => {
        const diff = it.income - it.expense;
        const tr   = document.createElement('tr');
  
        tr.innerHTML =
          `<td>${it.month}</td>` +
          `<td>${it.income.toLocaleString()}</td>` +
          `<td><span class="expense-value">${it.expense.toLocaleString()}</span> ` +
            `<button class="small-btn edit-expense">âœï¸</button></td>` +
          `<td class="highlight">${diff.toLocaleString()}</td>` +
          `<td><button class="small-btn delete-expense">âŒ</button></td>`;
        tr.querySelector('.edit-expense').addEventListener('click', () => {
          const span = tr.querySelector('.expense-value');
          const oldVal = span.textContent.replace(/,/g, '');
          const input = document.createElement('input'); input.type = 'number'; input.value = oldVal; input.classList.add('expense-input');
          span.replaceWith(input); input.focus();
          input.onblur = () => { it.expense = parseInt(input.value) || 0; saveExpenseDataToFirebase(); renderExpenseTable(); };
        });
        tr.querySelector('.delete-expense').addEventListener('click', () => { expenseData.splice(i, 1);saveExpenseDataToFirebase(); renderExpenseTable(); });
         tbody.appendChild(tr);
      });
  
    await updateEstimate();
  }

async function getMonthlyAverageByWeekday(year, month) {
    const snap = await db.ref('mealLogs').once('value');
    const data = snap.val() || {};
    const wk = ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '];
    const countO = { 'ì›”':0, 'í™”':0, 'ìˆ˜':0, 'ëª©':0, 'ê¸ˆ':0 };
    const countDays = { 'ì›”':0, 'í™”':0, 'ìˆ˜':0, 'ëª©':0, 'ê¸ˆ':0 };
    const daysInMonth = new Date(year, month, 0).getDate();
    const holidays = await getKoreanHolidays(year, month);

    // 1) í‰ì¼ì¼ìˆ˜ ì¹´ìš´íŠ¸
    for (let d = 1; d <= daysInMonth; d++) {
      const ds = `${year}-${String(month).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
      const dow = new Date(`${ds}T00:00:00+09:00`).getDay();
      const day = wk[dow];
      if (countDays[day] !== undefined && !holidays.includes(ds)) {
        countDays[day]++;
      }
    }

    // 2) í•´ë‹¹ ì›”ì˜ O ì²´í¬ ê±´ìˆ˜ ì§‘ê³„
    Object.values(data).forEach(days => {
      Object.entries(days).forEach(([date, v]) => {
        if (date.startsWith(`${year}-${String(month).padStart(2,'0')}`) 
            && String(v).toUpperCase() === 'O') {
          const dow = new Date(`${date}T00:00:00+09:00`).getDay();
          const day = wk[dow];
          if (countO[day] !== undefined) countO[day]++;
        }
      });
    });

    // 3) í‰ê·  ê³„ì‚°
    const result = {};
    ['ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ'].forEach(day => {
      const daysCnt = countDays[day] || 1;
      result[day] = +(countO[day] / daysCnt).toFixed(2);
    });
    return result;
  }

async function saveExpenseDataToFirebase() {
  expenseRef.set(expenseData)
    .catch(err => console.error('ExpenseData ì €ì¥ ì‹¤íŒ¨:', err));
}

//ì˜ˆìƒì§€ì¶œì•¡
async function getSeasonalAverageByWeekday() {
    const mealSnap = await db.ref('mealLogs').once('value');
    const data = mealSnap.val() || {};
  
    const wk = ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '];
    const seasons = { summer: {}, winter: {} };
    const counts  = { summer: {}, winter: {} };
    const datesBySeason = { summer: new Set(), winter: new Set() };
  
    // ì´ˆê¸°í™”
    ['ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ'].forEach(day => {
      seasons.summer[day] = 0;
      seasons.winter[day] = 0;
      counts.summer[day]  = 0;
      counts.winter[day]  = 0;
    });
  
    // âœ… O ì¹´ìš´íŠ¸ + ë‚ ì§œ ìˆ˜ì§‘
    Object.entries(data).forEach(([name, days]) => {
      Object.entries(days).forEach(([date, value]) => {
        if (!/^\d{4}-\d{2}-\d{2}$/.test(date)) return;
  
        const [year, monthStr] = date.split('-');
        const month = Number(monthStr);
        const season = (month >= 4 && month <= 9) ? 'summer' : 'winter';
  
        datesBySeason[season].add(date);
  
        const dow = new Date(`${date}T00:00:00+09:00`).getDay();
        const day = wk[dow];
        if (seasons[season][day] === undefined) return;
  
        if (typeof value === 'string' && value.trim().toUpperCase() === 'O') {
          seasons[season][day]++;
        }
      });
    });
  
    // âœ… ì‹œì¦Œë³„ ê³µíœ´ì¼ ëª©ë¡ êµ¬ì„±
    const holidayMap = {}; // key: ${season}_${date} â†’ true
  
    for (const season of ['summer', 'winter']) {
      for (const date of datesBySeason[season]) {
        const [y, m] = date.split('-').map(Number);
        const hols = await getKoreanHolidays(y, m);
        for (const h of hols) {
          holidayMap[`${season}_${h}`] = true;
        }
      }
    }
  
    // âœ… í‰ì¼ ìˆ˜ ì¹´ìš´íŠ¸
    for (const season of ['summer', 'winter']) {
      for (const date of datesBySeason[season]) {
        if (holidayMap[`${season}_${date}`]) continue;
        const dow = new Date(`${date}T00:00:00+09:00`).getDay();
        const day = wk[dow];
        if (counts[season][day] !== undefined) counts[season][day]++;
      }
    }
  
    // âœ… ìµœì¢… í‰ê·  ê³„ì‚°
    const result = { summer: {}, winter: {} };
    for (const season of ['summer', 'winter']) {
      for (const day of ['ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ']) {
        const totalMeals = seasons[season][day] || 0;
        const totalDays  = counts[season][day] || 1;
        result[season][day] = +(totalMeals / totalDays).toFixed(2);
      }
    }
  
    console.log('ğŸ“Š ì‹œì¦Œë³„ í‰ê·  ì‹ì‚¬ ì¸ì›:', result);
    return result;
  }
   
//ì˜ˆìƒì§€ì¶œì•¡ ê³„

async function updateEstimate() {
  const last = expenseData[expenseData.length - 1];
  const [y, m] = last.month.split('-').map(Number);
  const { ym, estimated, expr } = await calculateNextMonthEstimate(y, m);

  // 1) nextMonthEstimate ì—˜ë¦¬ë¨¼íŠ¸ ì•ˆì „ ì¡°íšŒ
  const nextEl = document.getElementById('nextMonthEstimate');
  if (nextEl) {
    nextEl.textContent = `${ym} ì˜ˆìƒ ì§€ì¶œì•¡: ${estimated.toLocaleString()}ì›`;
  } else {
    console.error('#nextMonthEstimate ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
  }

  // 2) estimateDetails ì—˜ë¦¬ë¨¼íŠ¸ ì•ˆì „ ì¡°íšŒ ë° innerHTML ì—…ë°ì´íŠ¸
  const detailEl = document.getElementById('estimateDetails');
  if (detailEl) {
    detailEl.innerHTML =
      `<strong>ê³„ì‚° ê·¼ê±°:</strong><br>` +
      `<em>Firebase ë°ì´í„° ê¸°ì¤€ : ìš”ì¼íšŸìˆ˜Ã—ìš”ì¼ë³„ í‰ê·  ì‹ìˆ˜ì¸ì›Ã—4500ì› ì‹œì¦Œ í‰ê· </em><br>` +
      `<strong>ê³„ì‚°ì‹:</strong> ${expr} = ${estimated.toLocaleString()}ì›`;
  } else {
    console.error('#estimateDetails ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
  }
 }
  const wkDays = ['ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ'];

async function calculateSeasonalAverageForForecast(baseYear, baseMonth) {
  // 1) ê³„ì ˆ ê²°ì •
  const season = (baseMonth >= 4 && baseMonth <= 9) ? 'summer' : 'winter';

  // 2) íˆìŠ¤í† ë¦¬ì»¬ í‚¤ í•„í„°ë§
  const histKeys = Object.keys(historicalMonthlyAverages || {})
    .filter(key => {
      const parts = key.split('-');
      if (parts.length !== 2) return false;
      const m = parseInt(parts[1], 10);
      if (Number.isNaN(m)) return false;
      const keySeason = (m >= 4 && m <= 9) ? 'summer' : 'winter';
      return keySeason === season;
    });

  // 3) í•©ì‚° ì´ˆê¸°í™”
  const sumAvg = wkDays.reduce((acc, d) => ({ ...acc, [d]: 0 }), {});

  // 4) ê³¼ê±° ë°ì´í„° í•©ì‚°
  histKeys.forEach(key => {
    const ma = historicalMonthlyAverages[key] || {};
    wkDays.forEach(d => {
      const v = ma[d];
      sumAvg[d] += (v != null ? v : 0);
    });
  });

  // 5) ì´ë²ˆ ë‹¬ ë™ì  í‰ê·  ì¶”ê°€
  const dynamicAvg = await getMonthlyAverageByWeekday(baseYear, baseMonth) || {};
  wkDays.forEach(d => {
    sumAvg[d] += (dynamicAvg[d] != null ? dynamicAvg[d] : 0);
  });

  // 6) ê°œì›” ìˆ˜ ê³„ì‚° ë° í‰ê· 
  const totalMonths = histKeys.length + 1;  // histKeys.lengthê°€ 0 ì´ìƒì„ì„ ì „ì œ
  const result = Object.fromEntries(
    wkDays.map(d => [d, +(sumAvg[d] / totalMonths).toFixed(2)])
  );

  return result;
}

async function calculateNextMonthEstimate(year, month) {
   // 1) ë‹¤ìŒ ë‹¬ ì—°ì›” ê³„ì‚°
  const nextMonth = month === 12 ? 1 : month + 1;
  const nextYear  = month === 12 ? year + 1  : year;
  const ym        = `${nextYear}-${String(nextMonth).padStart(2,'0')}`;

  const weekdayValues = await calculateSeasonalAverageForForecast(year, month);

  // 5) ë‹¤ìŒ ë‹¬ í‰ì¼ ì¼ìˆ˜ ì„¸ê³  ê¸ˆì•¡ ê³„ì‚°
  const daysInNext = new Date(nextYear, nextMonth, 0).getDate();
  const holidays   = await getKoreanHolidays(nextYear, nextMonth);
  const wk         = ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '];
  const cnt        = { ì›”:0, í™”:0, ìˆ˜:0, ëª©:0, ê¸ˆ:0 };

  for (let d = 1; d <= daysInNext; d++) {
    const ds  = `${nextYear}-${String(nextMonth).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
    const day = wk[new Date(`${ds}T00:00:00+09:00`).getDay()];
    if (cnt[day] !== undefined && !holidays.includes(ds)) {
      cnt[day]++;
    }
  }

    console.group(`â–¶ï¸ ${year}ë…„ ${month}ì›” â†’ ${nextYear}ë…„ ${nextMonth}ì›” ì˜ˆìƒì§€ì¶œ ê³„ì‚°`);
  console.log('1) íˆìŠ¤í† ë¦¬ì»¬+ë™ì ìœ¼ë¡œ ì¬ê³„ì‚°ëœ ìš”ì¼ë³„ í‰ê· (combinedAvg):');
  console.table(combinedAvg);
  console.log('2) ê¸°ì¤€ë‹¬ ë™ì  í‰ê· (dynamicAvg):');
  console.table(dynamicAvg);
  console.log('3) ë‹¤ìŒ ë‹¬ í‰ì¼ ì¼ìˆ˜(cnt):');
  console.table(cnt);
  console.groupEnd();
  
  // 4) ê¸ˆì•¡ ê³„ì‚° ë° exprParts ìƒì„±
  const cost      = 4500;
  let estimated   = 0;
  const exprParts = [];

  ['ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ'].forEach(d => {
    const daysCount = cnt[d];
    const avg       = weekdayValues[d] || 0;
    if (daysCount > 0) {
      const part = `(${d}:${daysCount}ì¼Ã—${avg}ëª…Ã—${cost}ì›)`;
      exprParts.push(part);
      estimated += daysCount * avg * cost;
    }
  });

  return {
    ym,
    estimated: Math.round(estimated),
    expr: exprParts.join(' + ')
  };
}

//ì•¼ê°„ì¡°ê´€ë¦¬
async function loadNightShiftData() {
  try {
      const [empSnap, roleSnap, exclSnap] = await Promise.all([
      db.ref('employees').once('value'),
      db.ref('employeeRoles').once('value'),
      db.ref('nightShiftExceptions').once('value') 
    ]);
    const allEmps = empSnap.val() || [];
    const empRoles = roleSnap.val() || {};
    const storedExceptions = exclSnap.val() || [];
    const contractEmps = allEmps.filter(name => empRoles[name] === 'contract');
    const leftUl = document.getElementById('leftNightList');
    const rightUl = document.getElementById('rightNightList');
    leftUl.innerHTML = '';
    rightUl.innerHTML = '';
    contractEmps.forEach(name => {
      const li = document.createElement('li');
      li.textContent = name;
      li.style.padding = '4px 8px';
      li.style.cursor = 'pointer';
      li.addEventListener('click', () => {
      li.classList.toggle('selected');
      li.style.backgroundColor = li.classList.contains('selected') ? '#d1eaff' : '';
      });

      if (storedExceptions.includes(name)) {
        rightUl.appendChild(li);
      } else {
        leftUl.appendChild(li);
      }
    });
  } catch (err) {
    console.error('loadNightShiftData error:', err);
  }
}
function moveSelected(srcId, dstId) {
  const srcUl = document.getElementById(srcId);
  const dstUl = document.getElementById(dstId);
  const selectedItems = Array.from(srcUl.querySelectorAll('li.selected'));
  selectedItems.forEach(li => {
    li.classList.remove('selected');
    li.style.backgroundColor = '';
    dstUl.appendChild(li);
  });
}
async function saveNightShiftExceptions() {
  try {
    const rightUl = document.getElementById('rightNightList');
    const namesArray = Array.from(rightUl.querySelectorAll('li')).map(li => li.textContent);
    await db.ref('nightShiftExceptions').set(namesArray);

    alert('âœ… ì•¼ê°„ì¡° ì œì™¸ ëŒ€ìƒì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');

    document.getElementById('nightShiftSettings').style.display = 'none';
  } catch (err) {
    console.error('saveNightShiftExceptions error:', err);
    alert('âš ï¸ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
  }
}

//íœ´ë¬´ì,ì•¼ê°„ì¡° ì—‘ì…€ì—…ë¡œë“œ
let parsedData = null;
let uploadFileName = '';

async function uploadToFirebase() {
  // 1) parsedData ê²€ì‚¬
  if (!parsedData || !Array.isArray(parsedData)) {
    return logUpload("âš ï¸ ë¨¼ì € ì˜¬ë°”ë¥¸ íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
  }
  // 2) fileName ê²€ì‚¬
  if (typeof uploadFileName !== 'string') {
    return logUpload("âš ï¸ íŒŒì¼ëª…ì´ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
  }

  const lowerName = uploadFileName.toLowerCase();
  let path = '';
  if (lowerName.includes('leave')) path = 'leave';
  else if (lowerName.includes('night')) path = 'nightShift';
  else {
    return logUpload('âš ï¸ íŒŒì¼ëª…ì— "leave" ë˜ëŠ” "night"ë¥¼ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.');
  }

  // 3) ê°ì²´ ìƒì„±
  const obj = {};
  parsedData.forEach(row => {
    const rawName = row.ì´ë¦„ || row.name;
    if (!rawName) return;
    const name = String(rawName).trim();
    if (!obj[name]) obj[name] = {};

    Object.entries(row).forEach(([k, v]) => {
      if ((k === 'ì´ë¦„' || k === 'name') || v == null) return;
      obj[name][k] = v;
    });
  });

  try {
    await  db.ref(path).set(obj);
      logUpload(`ğŸ‰ "${path}" ì—…ë¡œë“œ ì™„ë£Œ`);
       fileInput.value = '';
      parsedData = null;
      uploadFileName = '';
    }    catch(err) {logUpload(`âŒ ì—…ë¡œë“œ ì‹¤íŒ¨: ${err.message}`);
}}


function logUpload(msg) {
  document.getElementById('uploadLog').textContent = msg;
}

//DOM
document.addEventListener('DOMContentLoaded', async () => {
  try {
      const snapshot = await expenseRef.once('value');
      const firebaseData = snapshot.val();
      if (Array.isArray(firebaseData)) {
        expenseData = firebaseData;
      } else if (firebaseData && typeof firebaseData === 'object') {
          expenseData = Object.values(firebaseData);
      }
    } catch (err) {
      console.error('Firebaseì—ì„œ expenseData ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:', err);
    }
       await renderExpenseTable();

  ['monthSelectStats', 'monthSelect', 'monthSelectCharges'].forEach(id => { 
    if (document.getElementById(id)) { initMonthOptions(id); } else {      console.warn(`${id} ìš”ì†Œ ì—†ìŒ`);    }});
  document.getElementById('addExpenseRow').addEventListener('click', async () => {
    const last = expenseData[expenseData.length - 1];
    const [y, m] = last.month.split('-').map(Number);
    const { ym, estimated } = await calculateNextMonthEstimate(y, m);
    const income = await renderChargeTable();
    expenseData.push({ month: ym, income, expense: estimated }); saveExpenseDataToFirebase();
    await renderExpenseTable();
    });
  document.getElementById('toggleEstimate').addEventListener('click', () => {
    const detailEl = document.getElementById('estimateDetails');
    if (!detailEl) {
    console.warn('#estimateDetails ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
    return;
    }
    if (detailEl.style.display === 'none') {
    detailEl.style.display = 'block';
    } else {
    detailEl.style.display = 'none';
    }
    });
    Promise.all([
    db.ref('employees').once('value'),
    db.ref('employeeRoles').once('value')
    ]).then(([empSnap, roleSnap]) => {
     employees = empSnap.val() || [];
      employeeRoles = roleSnap.val() || {};
      regularList = employees.filter(n => employeeRoles[n] === 'regular');
     renderEmployeeList();
     });

      // ğŸ’¾ ì €ì¥ ë²„íŠ¼ ì´ë²¤íŠ¸ ë“±ë¡
      document.getElementById('saveAllBtn').addEventListener('click', () => {
  const newEmployees = [];
  const newRoles = {};

  // ìˆœì„œë¥¼ ë°˜ì˜í•´ input ìš”ì†Œ ìˆœíšŒ
  document.querySelectorAll('#employeeList li input').forEach(input => {
    const name = input.value.trim();
    if (name) {
      newEmployees.push(name);

      const group = input.closest('ul')?.previousElementSibling?.textContent;
      newRoles[name] = group.includes('ì¼ë°˜ì§') ? 'regular' : 'contract';
    }
  });

  employees = newEmployees;
  employeeRoles = newRoles;

  db.ref('employees').set(employees);
  db.ref('employeeRoles').set(employeeRoles);

  // ì•Œë¦¼ ëŒ€ì²´ìš©
  showToast('ğŸ’¾ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
  renderEmployeeList();
});

//ì„¤ì •> ê° íƒ­ í´ë¦­ì‹œ ì¤‘ë³µí™”ë©´ì—†ì´ í™”ë©´ ì „í™˜
function showSettingsSection(visibleId) {
  ['employeeSettings', 'nightShiftSettings', 'excelUploadSection']
    .forEach(id => {
      document.getElementById(id).style.display =
        (id === visibleId) ? 'block' : 'none';
    });
}
  
    //ì €ì¥ë©”ì„¸ì§€
function showToast(msg) {
  let toast = document.getElementById('toastMsg');
  if (!toast) {
    toast = document.createElement('div');
    toast.id = 'toastMsg';
    toast.style.position = 'fixed';
    toast.style.bottom = '20px';
    toast.style.left = '50%';
    toast.style.transform = 'translateX(-50%)';
    toast.style.background = '#333';
    toast.style.color = '#fff';
    toast.style.padding = '12px 20px';
    toast.style.borderRadius = '8px';
    toast.style.zIndex = '1000';
    document.body.appendChild(toast);
  }
  toast.textContent = msg;
  toast.style.opacity = '1';
  setTimeout(() => toast.style.opacity = '0', 2000);
}

  db.ref('employees').on('value', snap => { employees = snap.val() || []; renderEmployeeList(); });
  document.getElementById('monthSelectStats').addEventListener('change', renderStatsTable);
  document.getElementById('monthSelect')?.addEventListener('change', renderExpenseTable);
  document.getElementById('monthSelectCharges')?.addEventListener('change', renderChargeTable);
  document.getElementById('btnStats').addEventListener('click', () => { showSection('stats'); renderStatsTable(); });
  document.getElementById('btnExpenses').addEventListener('click', () => { showSection('expenses'); renderExpenseTable(); });
  document.getElementById('btnCharges').addEventListener('click', async () => {  showSection('charges');  const tbody = document.getElementById('chargeTableBody');  if (tbody) tbody.innerHTML = '';    await renderChargeTable();  });
  document.getElementById('btnSettings').addEventListener('click', () => { showSection('settings'); });
  document.getElementById('btnEmployees').addEventListener('click', () => {    showSettingsSection('employeeSettings');  });
  document.getElementById('btnNightShift').addEventListener('click', () => {    showSettingsSection('nightShiftSettings');    loadNightShiftData();  });
  document.getElementById('moveToRightBtn').addEventListener('click', () => moveSelected('leftNightList', 'rightNightList'));
  document.getElementById('moveToLeftBtn').addEventListener('click', () => moveSelected('rightNightList', 'leftNightList'));
  document.getElementById('saveNightShiftBtn').addEventListener('click', saveNightShiftExceptions);
  document.getElementById('btnExcelUpload').addEventListener('click', () => {    showSettingsSection('excelUploadSection');  });
  const fileInput = document.getElementById('fileInput');
  fileInput.addEventListener('click', () => {
    fileInput.value = '';
    parsedData = null;
    uploadFileName = '';
  });
  fileInput.addEventListener('change', (e) => {
    const file = e.target.files[0];
    uploadFileName = file.name.toLowerCase();

    if (!uploadFileName.endsWith('.csv')) {
      logUpload("âŒ CSV íŒŒì¼ë§Œ ì„ íƒ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
      parsedData = null;
      return;
    }

    const reader = new FileReader();
    reader.readAsText(file, 'euc-kr');
    reader.onload = (evt) => {
      const csvText = evt.target.result;
      parsedData = parseCSV(csvText);
      if (parsedData) {
        logUpload(`âœ… ${file.name} íŒŒì‹± ì™„ë£Œ (í–‰: ${parsedData.length})`);
      } else {
        logUpload("âŒ CSV íŒŒì‹± ì¤‘ ì˜¤ë¥˜");
      }
    };
    reader.onerror = () => {
      logUpload("âŒ íŒŒì¼ ì½ê¸° ì˜¤ë¥˜");
      parsedData = null;
    };
  });
  document.getElementById('uploadBtn').addEventListener('click', () => {
    if (!parsedData) {
      logUpload("âš ï¸ ë¨¼ì € CSV íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
      return;
    }

    let path = '';
    if (uploadFileName.includes('leave'))       path = 'leave';
    else if (uploadFileName.includes('night'))  path = 'nightShift';
    else {
      logUpload("âš ï¸ íŒŒì¼ëª…ì— `leave` ë˜ëŠ” `night`ê°€ í¬í•¨ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.");
      return;
    }

    const obj = {};
    parsedData.forEach(row => {
      const name = row.ì´ë¦„ || row.name;
      if (!name) return;
      obj[name] = {};
      Object.keys(row).forEach(k => {
        if (k !== 'ì´ë¦„' && k !== 'name') {
          obj[name][k] = row[k];
        }
      });
    });

    db.ref(path).set(obj)
      .then(() => {
        logUpload(`ğŸ‰ "${path}" ê²½ë¡œì— ì—…ë¡œë“œ ì™„ë£Œ!`);
        parsedData = null;
      })
      .catch(err => {
        logUpload("âŒ ì—…ë¡œë“œ ì˜¤ë¥˜: " + err.message);
      });
  });
  function parseCSV(text) {
    
    const lines = text.split(/\r\n|\n/).filter(line => line.trim() !== '');
    if (lines.length < 2) return null;

   
    const headers = lines[0].split(',').map(h => h.trim());

    const data = [];
    for (let i = 1; i < lines.length; i++) {
      const cells = lines[i].split(',');
    
      while (cells.length < headers.length) cells.push('');
      const obj = {};
      for (let j = 0; j < headers.length; j++) {
        obj[headers[j]] = cells[j].trim();
      }
      data.push(obj);
    }
    return data;
  }
  function logUpload(msg) {
    document.getElementById('uploadLog').textContent = msg;
  }
});

  </script>
</body>
</html>
