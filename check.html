<!DOCTYPE html>
<html lang="ko" style="width:80%; height:80%; margin:0; padding:0;">
<head>
  <meta charset="UTF-8" />
  <title>점심 식사 체크</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <style>
    html, body { width:140%; height:140%; margin:0; padding:0; }
    body { font-family: 'Segoe UI', sans-serif; background: #f2f2f2; display:flex; flex-direction:column; }
    h2 { margin:10px 0; font-size:24px; text-align:center; }
    #todayStat { font-size:16px; color:#333; text-align:center; margin-bottom:10px; }
    #main, #check { flex:1; display:flex; flex-direction:column; align-items:center; overflow:auto; }
    .button { padding:6px 12px; margin:5px; font-size:14px; cursor:pointer; border:none; border-radius:8px; background-color:#2196F3; color:white; }
    .button:hover { background-color:#1976D2; }
    .ox-btn { padding:6px 12px; margin:0 4px; border-radius:6px; border:none; font-size:16px; background-color:#e0e0e0; cursor:pointer; }
    .ox-btn.selected { background-color:#4caf50; color:white; }
    .grid { width:90%; display:grid; grid-template-columns:repeat(auto-fill, minmax(120px,1fr)); gap:10px; justify-items:center; }
    .name-btn { width:100%; background:#fff; border:1px solid #aaa; border-radius:10px; padding:10px; cursor:pointer; font-size:15px; }
    .group-label { font-weight:bold; margin-top:20px; font-size:18px; color:#555; }
    #dates { width:90%; flex:1; overflow-y:auto; text-align:center; }
    .date-row { margin:6px 0; display:flex; justify-content:center; align-items:center; }
    .today-highlight { border:2px solid #f44336; border-radius:8px; padding:4px; background-color:#ffecec; }
  </style>
</head>
<body>
  <h2>🍱 점심 식사 체크 - 오늘: <span id="todayDate"></span></h2>
  <div id="todayStat"></div>
  <div id="main">
    <div class="group-label">📌 일반직</div>
    <div class="grid" id="regular"></div>
    <div class="group-label">📌 기간제</div>
    <div class="grid" id="contract"></div>
  </div>
  <div id="check" style="display:none; width:100%;">
    <h2 id="selectedName"></h2>
    <select id="monthSelect" style="margin-bottom:10px;"></select>
    <div>
      <button class="button" onclick="saveMealLog()">✅ 저장</button>
      <button class="button" onclick="goBack()">⬅️ 뒤로</button>
    </div>
    <div id="dates"></div>
  </div>
  <script>
    let currentName = '';
    let values = {};
    const firebaseConfig = { apiKey:"AIzaSyD5TK7QNHXvQsjKNQ7136SxhP_lJ9PdbsM", authDomain:"lunch-20bb8.firebaseapp.com", databaseURL:"https://lunch-20bb8-default-rtdb.firebaseio.com", projectId:"lunch-20bb8", storageBucket:"lunch-20bb8.appspot.com", messagingSenderId:"218925939220", appId:"1:218925939220:web:4b8940a954f05bfb4a0501" };
    if(!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const names=["이영일","김정이","이현승","김성동","김미지","박병삼","김하은","한수진","임정아","김혜경","심규한","연경순","임경순","이민하","이유미","이윤희","최승필","홍선주","석순옥","정미경","이창례","임주연","김문정","김미영","심장식","손영복","손영부","강성필","김정근","오화진"];
    const regular=names.slice(0,10), contract=names.slice(10);
    const today=new Date(); today.setHours(today.getHours()+9);
    const thisYear=today.getFullYear(), thisMonth=today.getMonth(), todayISO=today.toISOString().split('T')[0];
    document.getElementById('todayDate').textContent=todayISO;
    function renderTodayStat(){ db.ref('mealLogs').once('value').then(snap=>{ const data=snap.val()||{}; let count=0; const isMon=new Date(todayISO).getDay()===1; names.forEach(n=>{ if(isMon&&contract.includes(n))return; if(data[n]&&data[n][todayISO]==='O')count++; }); document.getElementById('todayStat').textContent=`✅ 오늘 식사하는 인원: ${count}명`; }); }
    const holidays=['2025-05-05','2025-05-06','2025-06-03','2025-06-06'];
    const juneLeave=['2025-06-01','2025-06-06'], juneNight=['2025-06-03','2025-06-10','2025-06-11'];
    const nightNames=["연경순","임경순","최승필","홍선주","석순옥","이창례","임주연","김미영","심장식","손영복","손영부","강성필","김정근","오화진"];
    function isHoliday(date){return holidays.includes(date);}    
    function generateWorkdaysForMonth(y,m){ const days=[]; const total=new Date(y,m+1,0).getDate(); const mm=String(m+1).padStart(2,'0'); for(let d=1;d<=total;d++){ const iso=`${y}-${mm}-${String(d).padStart(2,'0')}`; const dow=new Date(iso).getDay(); if(dow<1||dow>5)continue; if(isHoliday(iso))continue; days.push(iso);} return days; }
    function renderMonthOptions(){ const sel=document.getElementById('monthSelect'); sel.innerHTML=''; for(let m=0;m<12;m++){ const opt=document.createElement('option'); opt.value=m; opt.textContent=`${m+1}월`; if(m===thisMonth) opt.selected=true; sel.appendChild(opt);} sel.onchange=()=>renderDates(currentName,Number(sel.value)); }
    function openCheck(name){ currentName=name; document.getElementById('main').style.display='none'; document.getElementById('check').style.display='flex'; renderMonthOptions(); renderDates(name,thisMonth); }
    function renderDates(name,month){ document.getElementById('selectedName').textContent=`${name} - ${thisYear}년 ${month+1}월`; const days=generateWorkdaysForMonth(thisYear,month); db.ref(`mealLogs/${name}`).once('value').then(snap=>{ values=snap.val()||{}; const cont=document.getElementById('dates'); cont.innerHTML=''; days.forEach(date=>{ if(contract.includes(name)&&new Date(date).getDay()===1)values[date]='X'; if(juneLeave.includes(date))values[date]='X'; if(nightNames.includes(name)&&juneNight.includes(date))values[date]='X'; const row=document.createElement('div'); row.className='date-row'; if(date===todayISO)row.classList.add('today-highlight'); const lbl=document.createElement('span'); lbl.textContent=`${date}: `; const btnO=document.createElement('button'); btnO.textContent='O'; btnO.className='ox-btn'; const btnX=document.createElement('button'); btnX.textContent='X'; btnX.className='ox-btn'; if(values[date]==='O')btnO.classList.add('selected'); if(values[date]==='X')btnX.classList.add('selected'); btnO.onclick=()=>{values[date]='O';btnO.classList.add('selected');btnX.classList.remove('selected');}; btnX.onclick=()=>{values[date]='X';btnX.classList.add('selected');btnO.classList.remove('selected');}; row.append(lbl,btnO,btnX); cont.appendChild(row); }); }); }
    function goBack(){ document.getElementById('check').style.display='none'; document.getElementById('main').style.display='flex'; }
    function saveMealLog(){ db.ref(`mealLogs/${currentName}`).set(values).then(()=>{ alert('저장되었습니다'); goBack(); }); }
    regular.forEach(n=>{ const btn=document.createElement('button'); btn.className='name-btn'; btn.textContent=n; btn.onclick=()=>openCheck(n); document.getElementById('regular').appendChild(btn);}  );
    contract.forEach(n=>{ const btn=document.createElement('button'); btn.className='name-btn'; btn.textContent=n; btn.onclick=()=>openCheck(n); document.getElementById('contract').appendChild(btn);}  );
    renderTodayStat();
  </script>
</body>
</html>
